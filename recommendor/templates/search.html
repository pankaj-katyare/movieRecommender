{% extends 'base.html' %}

{% block head %}
<title>Movie Recommendor</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<style>
  body,
  html {
    margin: 0;
    font-family: sans-serif;
    background-image: url("static/background3.gif");
    /* Full height */
    height: 100%;

    /* Center and scale the image nicely */
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed;
  }

  .glow-button {
    padding: 10px 10px;
    color: #800000;
    background: #e99f9f;
    letter-spacing: 2px;
    text-decoration: none;
    font-size: 1em;
    overflow: hidden;
    margin: 4px 2px;
    cursor: pointer;
    border: none;
  }

  /creating animation effect/
  .glow-button:hover {
    color: #111;
    background: #ff1433;
    box-shadow: 0 0 50px #ff1414;
  }
</style>
{% endblock %}


{% block body %}
<center>
  <h1 style="color:crimson;">Movie Recommendation System</h2>

    <p style="color:white;">Start typing:</p>

    <!--Make sure the form has the autocomplete function switched off:-->
    <form autocomplete="off" action="{{url_for('recommend')}}" method="POST">
      <div class="autocomplete" style="width:300px;">
        <input id="myInput" type="text" name="myTitle" placeholder="Type movie">
      </div>
      <br><br>
      <button type="submit" value="submit" class="glow-button">Submit</button>
    </form>
  </center>
  <script>
    $(document).ready(function () {
      console.log("HI");
  
      $.ajax({
        url: 'static/updated_movie_dataset.csv',
      }).done(function (response) {
        console.log(response);
        var allTextLines = response.split(/\r\n|\n/);
        // console.log("allTextLines > ", allTextLines);
        var firstLine = allTextLines[0];
        var colmns = firstLine.split(",");
        console.log("colmns > ", colmns);
        var movieTitle = [];

        for(var j=1; j<allTextLines.length; j++) {
          var vals = allTextLines[j].split(",");
          console.log(vals)
          movieTitle.push(vals[8]);
        }

        autocomplete(document.getElementById("myInput"), movieTitle);
        console.log("movieTitle > ", movieTitle);
      });
  
    });
  
    function autocomplete(inp, arr) {
      console.log("Hello3");
      /*the autocomplete function takes two arguments,
      the text field element and an array of possible autocompleted values:*/
      var currentFocus;
      /execute a function when someone writes in the text field:/
      inp.addEventListener("input", function (e) {
        var a, b, i, val = this.value;
        /close any already open lists of autocompleted values/
        closeAllLists();
        if (!val) { return false; }
        currentFocus = -1;
        /create a DIV element that will contain the items (values):/
        a = document.createElement("DIV");
        a.setAttribute("id", this.id + "autocomplete-list");
        a.setAttribute("class", "autocomplete-items");
        /append the DIV element as a child of the autocomplete container:/
        this.parentNode.appendChild(a);
        /for each item in the array.../
        for (i = 0; i < arr.length; i++) {
          /check if the item starts with the same letters as the text field value:/
          if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
            /create a DIV element for each matching element:/
            b = document.createElement("DIV");
            /make the matching letters bold:/
            b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
            b.innerHTML += arr[i].substr(val.length);
            /insert a input field that will hold the current array item's value:/
            b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
            /execute a function when someone clicks on the item value (DIV element):/
            b.addEventListener("click", function (e) {
              /insert the value for the autocomplete text field:/
              inp.value = this.getElementsByTagName("input")[0].value;
              /*close the list of autocompleted values,
              (or any other open lists of autocompleted values:*/
              closeAllLists();
            });
            a.appendChild(b);
          }
        }
      });
      /execute a function presses a key on the keyboard:/
      inp.addEventListener("keydown", function (e) {
        var x = document.getElementById(this.id + "autocomplete-list");
        if (x) x = x.getElementsByTagName("div");
        if (e.keyCode == 40) {
          /*If the arrow DOWN key is pressed,
          increase the currentFocus variable:*/
          currentFocus++;
          /and and make the current item more visible:/
          addActive(x);
        } else if (e.keyCode == 38) { //up
          /*If the arrow UP key is pressed,
          decrease the currentFocus variable:*/
          currentFocus--;
          /and and make the current item more visible:/
          addActive(x);
        } else if (e.keyCode == 13) {
          /If the ENTER key is pressed, prevent the form from being submitted,/
          e.preventDefault();
          if (currentFocus > -1) {
            /and simulate a click on the "active" item:/
            if (x) x[currentFocus].click();
          }
        }
      });
      function addActive(x) {
        /a function to classify an item as "active":/
        if (!x) return false;
        /start by removing the "active" class on all items:/
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        /add class "autocomplete-active":/
        x[currentFocus].classList.add("autocomplete-active");
      }
      function removeActive(x) {
        /a function to remove the "active" class from all autocomplete items:/
        for (var i = 0; i < x.length; i++) {
          x[i].classList.remove("autocomplete-active");
        }
      }
      function closeAllLists(elmnt) {
        /*close all autocomplete lists in the document,
        except the one passed as an argument:*/
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
          if (elmnt != x[i] && elmnt != inp) {
            x[i].parentNode.removeChild(x[i]);
          }
        }
      }
      /execute a function when someone clicks in the document:/
      document.addEventListener("click", function (e) {
        closeAllLists(e.target);
      });
    }
  
  
    // /An array containing all the country names in the world:/
    // var movies = ["Avatar", "Alien", "Guardians of the Galaxy", "The Helix... Loaded", "American Hero", "The Stepford Wives"];
    // /initiate the autocomplete function on the "myInput" element, and pass along the countries array as possible autocomplete values:/
    // console.log("Hello1");
    // autocomplete(document.getElementById("myInput"), movies);
    // console.log("Hello2");
  
  
  </script>
{% endblock %}